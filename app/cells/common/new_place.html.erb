<span class ='comment2-icon add_place'>发布我的地点</span> 
<div id="place_location" style="display:none"></div>
<br/>


<form accept-charset="UTF-8" action="/location/places" class="new_place" data-remote="true" enctype="multipart/form-data" id="new_place_form" method="post" onsubmit="">
  <input id="place_place_name" name="place[place_name]" placeholder="给你的地点起个名字" size="30" type="text" />
  <input id="place_full_address" name="place[full_address]" size="30" type="hidden" />
  <input id="place_place_latitude" name="place[place_latitude]" size="30" type="hidden" />
  <input id="place_place_longitude" name="place[place_longitude]" size="30" type="hidden" />
  <input id="picture_id" name="picture[id]" size="30" type="hidden" />
<br/>
<textarea cols="35" id="place_place_description" name="place[place_description]" placeholder="留下点说明吧。。。" rows="2" width="140px"></textarea>
<br/>
 是否公开该地点？<input name="place[is_public]" type="hidden" value="0" /><input id="place_is_public" name="place[is_public]" title="公开的地点无法删除" type="checkbox" value="1" />
<br/>
   <span class ='picture-icon' style='color: #5F9128;margin-top: 5px'>添加图片:&nbsp</span>
   <input type="file"  id ="fileToUpload_place" name ="picture" onchange="fileChange(this.value)" style="width:100px;"/>
</form>


<span  style=""class="button" id="sbumit_button" onclick="$('#new_place_form').submit();"><%=t('share.share')%></span>
<%=image_tag("loading.gif",:id=>"loading",:style=>"display:none;",:height=>20)%>
<span style="float:right;margin-right: 20px;"><%=image_tag("missing_tn.png",:id=>"temp_pic",:style=>"display:none",:height => '30')%></span>

<script>
  function fileChange(full_path){
    ajaxFileUpload();
  }
          
          
          
          
  function ajaxFileUpload(){
    loading();//动态加载小图标
    $.ajaxFileUpload({
      url:'/location/places/add_temp_pic',
      secureuri:false,
      dataType: 'json',
      fileElementId:'fileToUpload_place',
      success: function (data,status){
        if(data && data.success=="true"){
          $("#picture_id").attr("value",data.pic_id)
          $("#temp_pic").attr("src",data.pic_url);
          $("#temp_pic").attr("style","display:");
        }else{
          alert("文件保存失败")
        }
      },
      error: function (data, status, e){
        alert("文件保存失败")
      }
    })
    return false;
  }
  function loading(){
    $("#loading").ajaxStart(function(){
      $("#loading").show();
      $("#sbumit_button").removeAttr("onclick");

    }).ajaxComplete(function(){
      $("#loading").hide();
      $("#sbumit_button").bind( "click", function() { // 绑定新事件
        $('#new_place_form').submit();
      });
    });
  }
                    
</script>

